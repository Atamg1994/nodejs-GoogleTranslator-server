# Node translator server for XUnity.AutoTranslator
Скрипт node js сервер предназначен для правильного перевода текста на разные языки
с игнорированием html разметки и числовых значений а также ZM?Z формата числовых значений XUnity.AutoTranslator
Он предназначен для использования с настраиваемыми подключаемыми модулями перевода, назначаемыми конечной точкой, такими как AutoTranslator .
[AutoTranslator](https://github.com/bbepis/XUnity.AutoTranslator)
# Подробно проблемы 
* у меня были проблемы с тем что при переводе гугл переводчик мог как либо изменить html разметку (добавить пробелы и т.п)
* и проблема с ZM?Z - AutoTranslator таким образом помечать числовые значения чтобы потом после перевода закешировать их с правильным ключом во избежание повторного перевода
* но! гугл переводчик и ту мог все поломать
* AutoTranslator ожидает обратно свой ZM?Z чтобы подставить какое либо число но гугл перевел это на мой язык и AutoTranslator не смог найти по этому в кеше переводчика я вижу такую сроку 
* damage done {{A}}=нанесено урона змаз
* Иногда AutoTranslator почему-то не верно кэширует значения и потому может возникнуть дубли перевода с отличием лишь в числах даже с включённым TemplateAllNumberAway=True
* У меня включена опция
* TemplateAllNumberAway=True
* при переводе она создает темплейты 
* Costs {{A}} month = Стоимость {{A}} месяц
* Где {{A}} любое цифровое значение что помогает сократить запросы. 
  Зачем переводит заново если можно подставить уже готовый перевод. 
* а еще строка снизу может иметь эти параметры в произвольном порядке (это как чары на предмете в каком порядке наложишь в таком они и будут, что делает кучу таких строк в кэше AutoTranslator)
* 攻击力 +70\n获得稀有物品几率 +5%\n暴击倍率 +2%\n武技/灵技弹道数量增加 1\n武技/灵技射程增加 16%\n武技/灵技伤害增加 16%\n技能CD减少 1%\n<sprite\=2><color\=#444444>空白属性 可融合</color>
# Кратко что делает мой скрипт:
* Разбивает весь входящий текст через \n таким образом переводит эти части отдельно и кэширует отдельно.
* Фильтрует текст на наличие html разметки, числовых значений, ZM?Z превращает их в что-то подобное этому:
* (<color\=#00ff00>710</color>/6871) HP.  Такая строка станет такой (<1><2><3>/<4>) HP. Что позволит после сохранения в кэш и при получении на перевод последующих подобных текстов не переводит их а загрузить с кэша и подставить значения.
* Грубо говоря делает тоже самое что и задумка TemplateAllNumberAway=True в AutoTranslator но учитывает html разметку/
* также это помогает предотвратить изменение html разметки, гугл переводчиком
# Установка и запуск.
* Устанавливаем nodejs
* Распаковываем и запускаем start.cmd или командой node start.js 
* Конфиги AutoTranslator:
* Endpoint=CustomTranslateBanch
* TemplateAllNumberAway=True // не обязательно - но желательно, так как мой скрипт делает тоже самое, это еще сократит количество запросов. 
* Находим или добавляем в конец конфига [CustomTranslateBanch]. И под ним пишем такой адрес: url=http://localhost:3000/translate_batch_app
* Файл CustomTranslateBanch.dll кладём в папку переводчика.
* Для MelonLoader: game_path\UserLibs\Translators\CustomTranslateBanch.dll
* Для Bepinex: game_path\BepInEx\plugins\XUnity.AutoTranslator\Translators\CustomTranslateBanch.dll
* Мой скрипт использует бесплатный вариант Google Api поэтому может быть не стабильным.
