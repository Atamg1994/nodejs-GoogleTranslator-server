# Node translator server for XUnity.AutoTranslator
Это скрипт node js сервер предназначен для правильного перевода 
с игнорированием html разметки и числовых значений а также ZM?Z формата числовых значений XUnity.AutoTranslator
Он предназначен для использования с настраиваемыми подключаемыми модулями перевода, назначаемыми конечной точкой, такими как AutoTranslator .
[AutoTranslator](https://github.com/bbepis/XUnity.AutoTranslator)
# Подробно проблемы 
* у меня были проблемы с тем что при переводе гугл переводчик мог как либо изменить html разметку (добавить пробелы и т.п)
* и проблема с ZM?Z - AutoTranslator таким образом помечать числовые значения чтобы потом после перевода закешировать их с правильным ключом во избежание повторного перевода
* но! гугл переводчик и ту мог все поломать
* AutoTranslator ожидает обратно свой ZM?Z чтобы подставить какое либо число но гугл перевел это на мой язык и AutoTranslator не смог найти по этому примеру 
* "damage done {{A}}" я вижу "нанесено урона змаз"
* Иногда AutoTranslator почему-то не верно кэширует значения и потому может возникнуть дубли перевода с отличием лишь в числах даже с включённым TemplateAllNumberAway=True
* У меня Включена опция 
* TemplateAllNumberAway=True
* при переводе она создает темплейты 
* Costs {{A}} month=Стоимость {{A}} месяц
* Где {{A}} любое цифровое значение что помогает сократить запросы. 
  Зачем переводит заново если можно подставить уже готовый перевод. 
* а еще строка снизу может иметь эти параметры в произвольном порядке (это как чары на предмете в каком прядке наложишь в таком и они идут что делает кучу таких строк в кэше AutoTranslator)
* 攻击力 +70\n获得稀有物品几率 +5%\n暴击倍率 +2%\n武技/灵技弹道数量增加 1\n武技/灵技射程增加 16%\n武技/灵技伤害增加 16%\n技能CD减少 1%\n<sprite\=2><color\=#444444>空白属性 可融合</color>
# Кратко что решает мой скрипт 
* Разбивает весь входящий текст через \n таким образом переводит эти части отдельно и кэширует отдельно.
* Фильтрует текст на наличие html разметки, числовых значений, ZM?Z превращает их в что-то подобное этому:
* (<color\=#00ff00>710</color>/6871) HP  такая строка будет станет такой (<1><2><3>/<4>) HP что позволит после сохранения в кэш и при получении на перевод последующих подобных текстов не переводит их а загрузить с кэша и подставить значения
* грубо говоря делает тоже самое что и задумка TemplateAllNumberAway=True в AutoTranslator но учитывает html разметку/
* также это помогает предотвратить изменение html розметки, гугл переводчиком
# установка и запуск
* устанавливаем nodejs
* разархивируем и запускаем start.cmd или командой node start.js 
* AutoTranslator конфиги:
* Endpoint=CustomTranslateBanch
* TemplateAllNumberAway=True // не обязательно- но желательно, так как мой скрипт делает тоже самое, это еще сократит количество запросов. 
* [CustomTranslateBanch] находим и пишем такой адрес
* Url=http://localhost:3000/translate_batch_app
* ну и естественно нужно закинуть сам CustomTranslateBanch.dll в папку переводчика
* для MelonLoader game_path\UserLibs\Translators\CustomTranslateBanch.dll
* для Bepinex game_path\BepInEx\plugins\XUnity.AutoTranslator\Translators\CustomTranslateBanch.dll
* мой код использует бесплатный вариант Google Api поэтому может быть не стабильным.
